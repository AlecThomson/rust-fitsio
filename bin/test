#!/bin/bash
set -e
set -x

RUST_VERSION=${RUST_VERSION:-stable}

export CARGO_TARGET_DIR=target

for toml in $(find . -maxdepth 2 -name "Cargo.toml"); do
    cargo +${RUST_VERSION} test --manifest-path $toml
done

# Test the bindgen feature
cargo +${RUST_VERSION} test --manifest-path fitsio/Cargo.toml --features bindgen --no-default-features

# Test the full example
cargo +${RUST_VERSION} run --manifest-path fitsio/Cargo.toml --example full_example

# Test the array feature
cargo +${RUST_VERSION} test --manifest-path fitsio/Cargo.toml --features array
